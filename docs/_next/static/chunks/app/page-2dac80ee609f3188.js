(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{9343:(e,t,i)=>{Promise.resolve().then(i.bind(i,4538))},4538:(e,t,i)=>{"use strict";i.d(t,{Forge:()=>U});var s=i(7437),n=i(2265),a=i(2781),r=i(9943),o=i.n(r),l=i(1942),c=i(3500),u=i.n(c);function m(){return(0,s.jsx)("div",{className:u().LoadingBackdrop,children:(0,s.jsx)("div",{className:u().LoadingText,children:"Loading…"})})}var d=i(6356),p=i(7692),g=i(7261),f=i(3872),h=i(1109),_=i(9675),y=i(7135),x=i.n(y);function w(e){let{file:t,onDelete:i,onRename:a}=e,r=(0,n.useMemo)(()=>{var e,i;if(t.blobUri&&(null===(e=t.type)||void 0===e?void 0:e.genericType)==="image")return(0,s.jsx)("img",{className:x().PreviewIcon,src:t.blobUri,width:24,alt:""});if((null===(i=t.type)||void 0===i?void 0:i.genericType)==="audio")return(0,s.jsx)(h.Eow,{});if(/\.cs$/i.test(t.path))return(0,s.jsx)(g.HXH,{});if(/\.mis$/i.test(t.path))return(0,s.jsx)(_.Gw8,{});if(/\.dif$/i.test(t.path))return(0,s.jsx)(p.Mm0,{});if(/\.ter$/i.test(t.path))return(0,s.jsx)(d.seb,{});if(/\.spn$/i.test(t.path))return(0,s.jsx)(f.ekl,{});return null},[t]);return(0,s.jsxs)("div",{className:x().File,children:[(0,s.jsx)("span",{className:x().IconContainer,children:r})," ",(0,s.jsx)("span",{className:x().Path,onDoubleClick:()=>{let e=window.prompt("Rename file (".concat(t.path,"):"),t.path);e&&(e=e.trim().replace(/\/+/g,"/").replace(/^\//,"").replace(/\/$/,"").trim())&&e!==t.path&&a(t.path,e)},children:t.path}),(0,s.jsx)("button",{className:x().DeleteButton,type:"button","aria-label":"Delete",title:"Delete",onClick:e=>{i(t.path)},children:(0,s.jsx)(l.AMf,{})})]})}var b=i(9315),j=i.n(b),v=i(7170);function F(e){let t=e.split("/"),i="",s="";return(t.length>1?(i=t.slice(0,-1).join("/"),s=t[t.length-1]):(i="",s=t[0]),i)?"".concat(i,"/").concat(s):(/\.(l|m|h)(male|female|bioderm)\.png$/i.test(s)||/^(vehicle|weapon)_.+png$/i.test(s)||/^dcase\d\d\.png$/i.test(s)?i="textures/skins":/\.(ter|spn)$/i.test(s)?i="terrains":/\.mis$/i.test(s)?i="missions":/\.dif$/i.test(s)&&(i="interiors"),i)?"".concat(i,"/").concat(s):s}function L(e){if(e.type){if(/^image\//i.test(e.type))return{mimeType:e.type,genericType:"image"};if(/^audio\//i.test(e.type))return{mimeType:e.type,genericType:"audio"}}if(/\.png$/i.test(e.name))return{mimeType:"image/png",genericType:"image"};if(/\.jpg$/i.test(e.name))return{mimeType:"image/jpeg",genericType:"image"};if(/\.bmp$/i.test(e.name))return{mimeType:"image/bmp",genericType:"image"};if(/\.webp$/i.test(e.name))return{mimeType:"image/webp",genericType:"image"};if(/\.gif$/i.test(e.name))return{mimeType:"image/gif",genericType:"image"};if(/\.tiff$/i.test(e.name))return{mimeType:"image/tiff",genericType:"image"};if(/\.svg$/i.test(e.name))return{mimeType:"image/svg+xml",genericType:"image"};else if(/\.wav$/i.test(e.name))return{mimeType:"audio/wav",genericType:"audio"};else if(/\.mp3$/i.test(e.name))return{mimeType:"audio/mpeg",genericType:"audio"};return e.type?{mimeType:e.type,genericType:null}:null}async function T(e){let t=await j().loadAsync(e),i=new Map;for(let o in t.files){let l=t.files[o];if(!l.dir){var s,n,a,r;o=F(o);let t=await l.async("arraybuffer"),c={source:e.name||null,path:o,buffer:t,blobUri:null,date:l.date,unixPermissions:l.unixPermissions,dosPermissions:l.dosPermissions,type:L(l)};if((null===(s=c.type)||void 0===s?void 0:s.genericType)==="image"||(null===(n=c.type)||void 0===n?void 0:n.genericType)==="audio"){let e=new Blob([t],{type:null!==(r=null===(a=c.type)||void 0===a?void 0:a.mimeType)&&void 0!==r?r:""});c.blobUri=URL.createObjectURL(e)}i.set(o,c)}}return i}async function N(e){var t;let i;let s=new Map;if(e.path)(i=e.path).startsWith("/")&&(i=i.slice(1));else{if(!e.name)return s;i=e.name}let n={source:"direct upload",path:i=F(i),buffer:await new Promise((t,i)=>{let s=new FileReader;s.addEventListener("load",e=>{t(e.target.result)}),s.readAsArrayBuffer(e)}),blobUri:null,date:null,unixPermissions:null,dosPermissions:null,type:L(e)};return(null===(t=n.type)||void 0===t?void 0:t.genericType)==="image"&&(n.blobUri=URL.createObjectURL(e)),s.set(i,n),s}async function k(e){return/\.(zip|vl2)$/i.test(e.name)?T(e):N(e)}async function C(e,t){let i=await e.generateAsync({type:"blob",mimeType:"application/octet-stream"});(0,v.saveAs)(i,t)}var M=i(4658),B=i.n(M);function E(e){let{fileList:t}=e;return(0,s.jsxs)("form",{className:B().DownloadForm,onSubmit:async e=>{e.preventDefault();let i=e.target.elements.fileName,s=i.value.trim();if(s){if(t.length){let e=function(e){let t=new(j());for(let i of e)t.file(i.path,i.buffer,{date:i.date,dosPermissions:i.dosPermissions,unixPermissions:i.unixPermissions});return t}(t);await C(e,"".concat(s,".vl2"))}else window.alert("Add some files!")}else window.alert("Name thy file."),i.focus()},children:[(0,s.jsx)("div",{className:B().NameInput,children:(0,s.jsx)("input",{name:"fileName",type:"text",placeholder:"name thy file",onChange:e=>{/\.vl2$/i.test(e.target.value)&&(e.target.value=e.target.value.slice(0,-4))}})}),(0,s.jsx)("button",{type:"submit",className:B().DownloadButton,children:"Download"})]})}var A=i(7673),P=i.n(A),$=i(2655),D=i(3051),I=i(2238),R=i.n(I);function H(e){let{actionLog:t}=e,[i,a]=(0,n.useState)(!1),[r,o]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{i||o(!1)},[i]),(0,n.useEffect)(()=>{t.length>0&&o(!0)},[t]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{type:"button",className:"".concat(R().MessagesButton," ").concat(r?R().NewMessages:""),onClick:()=>{a(e=>!e)},children:(0,s.jsx)($.m2k,{})}),(0,s.jsxs)("div",{className:R().ActionLog,hidden:!i,children:[(0,s.jsx)("button",{className:R().CloseButton,type:"button",onClick:()=>{a(!1)},children:(0,s.jsx)(D.qGf,{})}),t.map((e,t)=>{switch(e.type){case"BATCH_OVERWRITE":return(0,s.jsxs)("p",{children:["File at ",(0,s.jsx)("span",{className:R().Path,children:e.path})," ","from ",(0,s.jsx)("del",{children:e.oldSource})," was replaced with the one from ",(0,s.jsx)("ins",{children:e.newSource})," because of the priority in which it was handled."]},t);case"NEW_OVERWRITE":return(0,s.jsxs)("p",{children:["File at ",(0,s.jsx)("span",{className:R().Path,children:e.path})," ","from ",(0,s.jsx)("del",{children:e.oldSource})," was replaced with the one from ",(0,s.jsx)("ins",{children:e.newSource})," because it is a newer upload."]},t);default:return null}})]})]})}let S={files:new Map,actionLog:[]};function U(){let[e,t]=(0,n.useTransition)(),[i,r]=(0,n.useState)(0),[c,u]=(0,n.useState)(S),{files:d,actionLog:p}=c,g=(0,n.useCallback)(async e=>{r(e=>e+1);let t=[],i=new Map,s=o()(Array.from(e),[e=>{var t;return(null!==(t=e.name)&&void 0!==t?t:"").toLowerCase()}],["asc"]);(await Promise.all(s.map(e=>k(e)))).forEach(e=>{e.forEach((e,s)=>{i.has(s)&&t.push({type:"BATCH_OVERWRITE",path:s,oldSource:i.get(s).source,newSource:e.source}),i.set(s,e)})}),u(e=>{let{files:s,actionLog:n}=e,a=[...n,...t],r=new Map(s);return i.forEach((e,t)=>{r.has(t)&&a.push({type:"NEW_OVERWRITE",path:t,oldSource:r.get(t).source,newSource:e.source}),r.set(t,e)}),{files:r,actionLog:a.length===n.length?n:a}}),r(e=>e-1)},[]),{getRootProps:f,getInputProps:h,open:_,isDragActive:y}=(0,a.uI)({noClick:!0,noKeyboard:!0,onDrop:g}),x=(0,n.useMemo)(()=>o()(Array.from(d.keys()),[e=>e.toLowerCase()],["asc"]).map(e=>d.get(e)),[d]),b=(0,s.jsx)("button",{type:"button",className:P().AddButton,"aria-label":"Add files",title:"Add files",onClick:_,children:"+"}),j=(0,n.useCallback)(e=>{u(t=>{let i=new Map(t.files);return i.delete(e),{files:i,actionLog:t.actionLog}})},[]),v=(0,n.useCallback)((e,t)=>{u(i=>{let s={...i.files.get(e),path:t},n=new Map(i.files);return n.delete(e),n.set(t,s),{files:n,actionLog:i.actionLog}})},[]),F=e||i>0;return(0,s.jsxs)("section",{className:P().Forge,...f(),children:[(0,s.jsxs)("header",{className:P().Header,children:[(0,s.jsx)("a",{className:P().HeaderLink,href:"https://github.com/exogen/vl2-forge",children:(0,s.jsx)(l.hJX,{"aria-label":"GitHub"})}),(0,s.jsx)("img",{className:P().Logo,width:210,height:188,src:"/vl2-forge/logo-md.png",alt:"VL2 Forge"}),b]}),(0,s.jsx)("input",{...h()}),(0,s.jsxs)("div",{className:P().ListArea,children:[F?(0,s.jsx)(m,{}):null,x.length?(0,s.jsx)("ul",{className:P().FileList,children:x.map(e=>(0,s.jsx)("li",{children:(0,s.jsx)(w,{file:e,onDelete:j,onRename:v})},e.path))}):F?null:(0,s.jsx)("div",{className:P().EmptyMessage,children:"Drop files onto the page or press the add button. No need to extract existing .vl2 files first –\xa0just drop ‘em in and it’ll take care of that!"})]}),(0,s.jsxs)("footer",{className:P().Footer,children:[(0,s.jsx)("a",{className:P().FooterLink,href:"https://github.com/exogen/vl2-forge",children:(0,s.jsx)(l.hJX,{"aria-label":"GitHub"})}),(0,s.jsx)(E,{fileList:x}),(0,s.jsx)(H,{actionLog:p})]})]})}},4658:e=>{e.exports={DownloadForm:"DownloadForm_DownloadForm__xJrhQ",NameInput:"DownloadForm_NameInput__rJoTF",DownloadButton:"DownloadForm_DownloadButton__THR8u"}},7135:e=>{e.exports={File:"FileItem_File__FC9Rk",IconContainer:"FileItem_IconContainer__B0pA0",PreviewIcon:"FileItem_PreviewIcon__CVUKY",Path:"FileItem_Path__6Y42m",DeleteButton:"FileItem_DeleteButton__qYt5o"}},7673:e=>{e.exports={Forge:"Forge_Forge__dDZFe",Footer:"Forge_Footer__ghw3O",ListArea:"Forge_ListArea__OpY_R",FileList:"Forge_FileList__9JOyh",EmptyMessage:"Forge_EmptyMessage__Lrlud",AddButton:"Forge_AddButton__09pXD",Header:"Forge_Header__7t3Qc",HeaderLink:"Forge_HeaderLink__fEDGG",FooterLink:"Forge_FooterLink__gznaM"}},3500:e=>{e.exports={LoadingBackdrop:"Loading_LoadingBackdrop__9nxZJ",LoadingText:"Loading_LoadingText__cJZao"}},2238:e=>{e.exports={MessagesButton:"Messages_MessagesButton__7CUm6",CloseButton:"Messages_CloseButton__66g2r",NewMessages:"Messages_NewMessages__r7_5G",ActionLog:"Messages_ActionLog__Bgwa6",Path:"Messages_Path__g_kWC"}}},e=>{var t=t=>e(e.s=t);e.O(0,[995,950,522,665,51,212,516,675,240,699,515,130,215,744],()=>t(9343)),_N_E=e.O()}]);